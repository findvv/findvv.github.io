<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>jquery（2.1.4）源码分析 | 小玩的后花园</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="jquery（2.1.4）源码分析

试着去分析下常用的jquery库的源码，来提高姿势水平。源码在：传送门。争取每天都更新一点，多多学习。">
<meta property="og:type" content="article">
<meta property="og:title" content="jquery（2.1.4）源码分析">
<meta property="og:url" content="http://yoursite.com/2015/10/26/myJquery/index.html">
<meta property="og:site_name" content="小玩的后花园">
<meta property="og:description" content="jquery（2.1.4）源码分析

试着去分析下常用的jquery库的源码，来提高姿势水平。源码在：传送门。争取每天都更新一点，多多学习。">
<meta property="og:updated_time" content="2015-10-26T03:00:44.792Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jquery（2.1.4）源码分析">
<meta name="twitter:description" content="jquery（2.1.4）源码分析

试着去分析下常用的jquery库的源码，来提高姿势水平。源码在：传送门。争取每天都更新一点，多多学习。">
  
    <link rel="alternative" href="/atom.xml" title="小玩的后花园" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.jpg">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="/css/pubu.css">
  <script type="text/javascript" src="/js/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/face.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">张小玩</a></h1>
		</hgroup>

		
		<p class="header-subtitle">不忘初心，方得始终</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="javascript:clickPhoto();">照片墙</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/findvv/" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://zhihu.com/" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:732078828@qq.com/" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/何弃疗/" style="font-size: 20px;">何弃疗</a> <a href="/tags/看世界/" style="font-size: 10px;">看世界</a> <a href="/tags/老司机/" style="font-size: 10px;">老司机</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://findvv.com/">羊习习的测试站</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">曾经热爱骑行的追风少年如今面目可憎的码农大叔</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">张小玩</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/face.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">张小玩</h1>
			</hgroup>
			
			<p class="header-subtitle">不忘初心，方得始终</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="javascript:clickPhoto();">照片墙</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/findvv/" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://zhihu.com/" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:732078828@qq.com/" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-myJquery" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/26/myJquery/" class="article-date">
  	<time datetime="2015-10-26T02:45:58.000Z" itemprop="datePublished">2015-10-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      jquery（2.1.4）源码分析
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/何弃疗/">何弃疗</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="jquery（2-1-4）源码分析"><strong>jquery（2.1.4）源码分析</strong></h1><hr>
<blockquote>
<p>试着去分析下常用的jquery库的源码，来提高姿势水平。源码在：<a href="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js" target="_blank" rel="external">传送门</a>。<br>争取每天都更新一点，多多学习。</p>
</blockquote>
<hr>
<a id="more"></a>
<h1 id="第一天">第一天</h1><p>首先映入眼帘的是这一些：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> global, factory </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span>.exports === <span class="string">"object"</span> ) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = global.document ?</span><br><span class="line">      factory( global, <span class="literal">true</span> ) :</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params"> w </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( !w.document ) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( <span class="string">"jQuery requires a window with a document"</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> factory( w );</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    factory( global );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> ? <span class="built_in">window</span> : <span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> window, noGlobal </span>) </span>&#123;</span><br><span class="line">    <span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<p>看注释可以知道，这些代码是为了适用于CommonJS and CommonJS-like 环境</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> ? <span class="built_in">window</span> : <span class="keyword">this</span></span><br></pre></td></tr></table></figure>
<p>在浏览器环境中global的实参为window，其余为this，也就是说，</p>
<h2 id="1-在我们常用的浏览器环境中(未使用CommonJS规范)">1.在我们常用的浏览器环境中(未使用CommonJS规范)</h2><p>代码简化为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">factory</span>) </span>&#123;</span><br><span class="line">  factory( global );</span><br><span class="line">&#125;(<span class="function"><span class="keyword">function</span>(<span class="params"> window, noGlobal </span>) </span>&#123;</span><br><span class="line"><span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<p>可以很容易理解成：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> global, noGlobal </span>) </span>&#123;</span><br><span class="line"><span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure></p>
<p>这就类似老版本的jquery源码，匿名函数自执行。</p>
<p><strong>新版本的jquery可以在这里很神奇的发现，已经不管老版本的IE浏览器了，原因如下：</strong></p>
<hr>
<ol>
<li>IE7以下的浏览器可以人为更改undefined，比如undefined = 1;</li>
<li>strundefined变量就是Number;</li>
<li>没有传noGlobal参数，typeof noGlobal为undefined;</li>
<li>typeof noGlobal!=strundefined那就进入不到9280—9287行这里面了，也就无法在全局绑定jQuery</li>
</ol>
<hr>
<p>如果哪个蛋疼的孩子在IE7下人为修改了undefined变量，就用不了jQuery了，不得不说这是一个很大的进步！<br>有关于为什么2.0以后版本不支持IE8，请移步<br><a href="http://blog.jquery.com/2012/07/01/jquery-1-9-and-2-0-tldr-edition/" target="_blank" rel="external">http://blog.jquery.com/2012/07/01/jquery-1-9-and-2-0-tldr-edition/</a></p>
<h2 id="2-在浏览器环境中使用CommonJS规范的情况下">2.在浏览器环境中使用CommonJS规范的情况下</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> global, factory </span>) </span>&#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = factory( global, <span class="literal">true</span> );</span><br><span class="line">&#125;(<span class="built_in">window</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> window, noGlobal </span>) </span>&#123;</span><br><span class="line">    <span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>可以很容易理解成：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = (<span class="function"><span class="keyword">function</span>(<span class="params"> global, noGlobal </span>) </span>&#123;</span><br><span class="line"><span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;)(<span class="built_in">window</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>这里就能看出来具体实现代码为什么要return jQuery了，因为noGlobal===true,不满足if条件，避免了在window上绑定jQuery，反而把jQuery暴露给公开的接口module.exports = jQuery，这样在使用的时候就能获取到了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jQuery = <span class="built_in">require</span>(<span class="string">"jQuery"</span>);</span><br></pre></td></tr></table></figure></p>
<p>再加一句，之所以要加global参数并且将window赋值于global，是因为作用域链更容易查找到window，提高性能。</p>
<h2 id="3-在非浏览器环境中使用CommonJS规范的情况下">3.在非浏览器环境中使用CommonJS规范的情况下</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"> factory </span>) </span>&#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"> w </span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> ( !w.document ) &#123;</span><br><span class="line">                      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( <span class="string">"jQuery requires a window with a document"</span> );</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> factory( w );</span><br><span class="line">                  &#125;;</span><br><span class="line">&#125;(<span class="function"><span class="keyword">function</span>(<span class="params"> window, noGlobal </span>) </span>&#123;</span><br><span class="line">    <span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>可以很容易理解成：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"> w </span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> ( !w.document ) &#123;</span><br><span class="line">                  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( <span class="string">"jQuery requires a window with a document"</span> );</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>  <span class="function"><span class="keyword">function</span>(<span class="params"> window, noGlobal </span>) </span>&#123;</span><br><span class="line">                                <span class="comment">//具体实现代码</span></span><br><span class="line">                                <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">                                    <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">return</span> jQuery;</span><br><span class="line">                            &#125;( w );</span><br><span class="line">              &#125;;</span><br></pre></td></tr></table></figure></p>
<p>这样，在以后使用jQuery的时候一般都这么写<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'./jQuery .js'</span>)(<span class="built_in">window</span>); </span><br><span class="line">$(<span class="string">'#id'</span>);</span><br></pre></td></tr></table></figure></p>
<p>可以看出，将window或者其他变量当w参数传进去，如果!w.document成立，那就抛出一个错误，否则的话，直接把w参数传递给<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"> window, noGlobal </span>) </span>&#123;</span><br><span class="line">    <span class="comment">//具体实现代码</span></span><br><span class="line">    <span class="keyword">var</span> strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>;<span class="comment">//4607行</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> noGlobal === strundefined) &#123;<span class="comment">//9280--9287行</span></span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;( w );</span><br></pre></td></tr></table></figure></p>
<p>也相当于一个匿名函数自执行。</p>
<p><strong>综上所述<br>这一些老版本的jQuery没有的代码，是为了符合commonJS规范，以及为了更好地使jQuery应用于各个环境中做的适配</strong></p>
<h1 id="第二天">第二天</h1><p>开始分析具体实现代码<br>首先定义了一堆私有变量<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//16--68行</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">var</span> slice = arr.slice;</span><br><span class="line"><span class="keyword">var</span> concat = arr.concat;</span><br><span class="line"><span class="keyword">var</span> push = arr.push;</span><br><span class="line"><span class="keyword">var</span> indexOf = arr.indexOf;</span><br><span class="line"><span class="keyword">var</span> class2type = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> toString = class2type.toString;</span><br><span class="line"><span class="keyword">var</span> hasOwn = class2type.hasOwnProperty;</span><br><span class="line"><span class="keyword">var</span> support = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">    version = <span class="string">"2.1.4"</span>,</span><br><span class="line">    jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context);</span><br><span class="line">    &#125;,</span><br><span class="line">    rtrim = <span class="regexp">/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g</span>,</span><br><span class="line">    rmsPrefix = <span class="regexp">/^-ms-/</span>,</span><br><span class="line">    rdashAlpha = <span class="regexp">/-([\da-z])/gi</span>,</span><br><span class="line">    fcamelCase = <span class="function"><span class="keyword">function</span>(<span class="params">all, letter</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> letter.toUpperCase();</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p>
<p>都是一些平淡无奇的东西，有意思的在<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="1-实现无new创建新的jQuery实例对象">1.实现无new创建新的jQuery实例对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一般来说我们创建一个对象</span></span><br><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个对象的实例</span></span><br><span class="line"><span class="keyword">new</span> jQuery(<span class="string">'#id'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//但是我们用到的一般都是$('#id'),也就是jQuery('#id')，并没有new关键词，那么可以想象成</span></span><br><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> jQuery(selector);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显而易见，陷入到了死循环，看下jQuery源码是怎样实现的</span></span><br><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在源码92行</span></span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;&#125;</span><br><span class="line"><span class="comment">//jQuery.fn实际上是jQuery.protytpe的简写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在源码2735行</span></span><br><span class="line"><span class="keyword">var</span> init = jQuery.fn.init = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>)</span>&#123;</span><br><span class="line"><span class="comment">//具体选择器的实现代码</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//由此可以看出，实际上jQuery把各种选择器的代码写在了jQuery原型上的init方法。</span></span><br><span class="line"><span class="comment">//但这样就会存在问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//比方说给jQuery原型添加一个属性</span></span><br><span class="line">jQuery.fn.name = <span class="string">"Me"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按理来说 jQuery('#id').name能够获取到 "Me"</span></span><br><span class="line"><span class="comment">//但是根据以下代码</span></span><br><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//jQuery('#id')实际上是实现了new jQuery.fn.init('#id').name;</span></span><br><span class="line"><span class="comment">//但是jQuery.fn.init.name并不存在，那么就是获取不到jQuery('#id').name这个属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在源码2835行，jQuery给出了解决办法(注意var init = jQuery.fn.init)</span></span><br><span class="line">init.prototype = jQuery.fn;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这样就打通了一个桥梁，在查找jQuery.fn.init.name时候找不到，那按照原型链查找原型链上的name属性，就会去寻找</span></span><br><span class="line"><span class="comment">//jQuery.fn.init.prototype.name，又正好jQuery.fn.init.prototype = jQuery.fn，相当于去寻找</span></span><br><span class="line"><span class="comment">//jQuery.fn.name ,找到了，就是"Me"!</span></span><br></pre></td></tr></table></figure>
<p>由此可见，为了实现无new创建jQuery对象真是煞费苦心啊！</p>
<h2 id="2-定义在jQuery原型上的一些属性和方法">2.定义在jQuery原型上的一些属性和方法</h2><p>先说一句，绑定在原型上的方法必须是实例化之后才能调用的，类似于常见的jQuery(‘#id’).html());</p>
<p>直接绑定在jQuery对象上的方法是相当于工具方法，直接调用，类似于jQuery.each(function(){});</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//92--175行</span></span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">  jquery: version,</span><br><span class="line">  constructor: jQuery,</span><br><span class="line">  selector: <span class="string">""</span>,</span><br><span class="line">  length: <span class="number">0</span>,</span><br><span class="line">  toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> slice.call( <span class="keyword">this</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num != <span class="literal">null</span> ?</span><br><span class="line">      ( num &lt; <span class="number">0</span> ? <span class="keyword">this</span>[ num + <span class="keyword">this</span>.length ] : <span class="keyword">this</span>[ num ] ) :</span><br><span class="line">      slice.call( <span class="keyword">this</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ret = jQuery.merge( <span class="keyword">this</span>.constructor(), elems );</span><br><span class="line">    ret.prevObject = <span class="keyword">this</span>;</span><br><span class="line">    ret.context = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;,</span><br><span class="line">  each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><br><span class="line">  &#125;,</span><br><span class="line">  map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;,</span><br><span class="line">  slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( slice.apply( <span class="keyword">this</span>, <span class="built_in">arguments</span> ) );</span><br><span class="line">  &#125;,</span><br><span class="line">  first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.eq( <span class="number">0</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.eq( -<span class="number">1</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  eq: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = <span class="keyword">this</span>.length,</span><br><span class="line">      j = +i + ( i &lt; <span class="number">0</span> ? len : <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( j &gt;= <span class="number">0</span> &amp;&amp; j &lt; len ? [ <span class="keyword">this</span>[j] ] : [] );</span><br><span class="line">  &#125;,</span><br><span class="line">  end: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.prevObject || <span class="keyword">this</span>.constructor(<span class="literal">null</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  push: push,</span><br><span class="line">  sort: arr.sort,</span><br><span class="line">  splice: arr.splice</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>逐行分析</p>
<p>1.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jquery: version,</span><br></pre></td></tr></table></figure></p>
<pre><code>jquery的版本，比如这里$<span class="class">.prototype</span><span class="class">.jquery</span>或者$(<span class="string">'#id'</span>).jquery是<span class="string">"2.1.4"</span>
</code></pre><ol>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">constructor: jQuery,</span><br></pre></td></tr></table></figure>
<pre><code>在 JavaScript 中，每个函数都有名为“prototype”的属性，用于引用原型对象。此原型对象又有名为“<span class="function"><span class="keyword">constructor</span>”的属性，它反过来引用函数本身，在这里，重写了<span class="title">jQuery</span>.<span class="title">prototype</span>，<span class="title">jQuery</span>.<span class="title">prototype</span>实际上是<span class="title">Object</span><span class="params">()</span>，如果没有这一句的话，<span class="title">jQuery</span>.<span class="title">prototype</span>.<span class="title">constructor</span>就不是它的构造函数<span class="title">jQuery</span>了，而是<span class="title">function</span> <span class="title">Object</span><span class="params">()</span>，就失去了与原有的构造函数的联系了。</span>
</code></pre></li>
</ol>
<p>3<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">selector: <span class="string">""</span>,</span><br><span class="line">length: <span class="number">0</span>,</span><br><span class="line"><span class="string">``</span><span class="string">`   </span><br><span class="line">jquery原型默认的属性</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line"></span><br><span class="line">`</span><span class="string">``</span>javascript</span><br><span class="line">toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> slice.call( <span class="keyword">this</span> );</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<pre><code><span class="tag">slice</span>在上文中可以找到，为<span class="attr_selector">[]</span><span class="class">.slice</span>，在控制台输出<span class="attr_selector">[]</span><span class="class">.slice</span>可以看到输出<span class="tag">function</span> <span class="tag">slice</span>()
</code></pre><p>以下内容—<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice" target="_blank" rel="external">参考</a></p>
<pre><code>slice 方法可以用来将一个类数组（<span class="built_in">Array</span>-like）对象/集合转换成一个数组。你只需将该方法绑定到这个对象上。下述代码中 list 函数中的 <span class="built_in">arguments</span> 就是一个类数组对象。
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">list</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> list1 = list(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1, 2, 3]</span></span><br><span class="line"><span class="string">``</span><span class="string">` </span><br><span class="line">    </span><br><span class="line">        除了使用 Array.prototype.slice.call(arguments)，你也可以简单的使用 [].slice.call(arguments) 来代替。</span><br><span class="line">        </span><br><span class="line">        this指代的是该jQuery对象，这下了解了，实际上是把类似于$('#id')的jQuery对象转换成一个数组，实际上jQuery是个类数组对象，比如$('#id')返回的就是[&lt;div id="id"&gt;&lt;/div&gt;]</span><br><span class="line">    </span><br><span class="line">    测试用例：</span><br><span class="line">`</span><span class="string">``</span>javascript   </span><br><span class="line">    <span class="keyword">var</span> jq = $(<span class="string">'#id'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> jqToArray = jq.toArray();       <span class="comment">//实际上相当于 Array.prototype.slice.call($('#id'));</span></span><br><span class="line">    </span><br><span class="line">    jqToArray <span class="keyword">instanceof</span> <span class="built_in">Array</span>          <span class="comment">//true</span></span><br><span class="line">    </span><br><span class="line">    jqToArray <span class="keyword">instanceof</span> jQuery         <span class="comment">//false</span></span><br><span class="line">    </span><br><span class="line">    jq <span class="keyword">instanceof</span> <span class="built_in">Array</span>                 <span class="comment">//false</span></span><br><span class="line">    </span><br><span class="line">    jq <span class="keyword">instanceof</span> jQuery                <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>5.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">get: <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num != <span class="literal">null</span> ?</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return just the one element from the set</span></span><br><span class="line">    ( num &lt; <span class="number">0</span> ? <span class="keyword">this</span>[ num + <span class="keyword">this</span>.length ] : <span class="keyword">this</span>[ num ] ) :</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return all the elements in a clean array</span></span><br><span class="line">    slice.call( <span class="keyword">this</span> );</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<pre><code>举个例子一目了然：

$(<span class="string">'#id'</span>).get(<span class="literal">null</span>)相当于<span class="built_in">Array</span>.prototype.slice.call($(<span class="string">'#id'</span>));也就跟上面的toArray方法一致

$(<span class="string">'.class'</span>).get(-<span class="number">1</span>)相当于$(<span class="string">'.class'</span>)[-<span class="number">1</span> + $(<span class="string">'.class'</span>).length]，也就是匹配倒数第一个jq对象
</code></pre><p>  $(‘.class’).get(1)相当于$(‘.class’)[1]，也就是匹配正数第二个jq对象</p>
<p>6.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Build a new jQuery matched element set</span></span><br><span class="line">  <span class="keyword">var</span> ret = jQuery.merge( <span class="keyword">this</span>.constructor(), elems );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the old object onto the stack (as a reference)</span></span><br><span class="line">  ret.prevObject = <span class="keyword">this</span>;</span><br><span class="line">  ret.context = <span class="keyword">this</span>.context;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Return the newly-formed element set</span></span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>就着这段代码，找到jQuery的merge方法在423行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">...</span><br><span class="line">merge: <span class="function"><span class="keyword">function</span>(<span class="params"> first, second </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = +second.length,</span><br><span class="line">      j = <span class="number">0</span>,</span><br><span class="line">      i = first.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( ; j &lt; len; j++ ) &#123;</span><br><span class="line">      first[ i++ ] = second[ j ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    first.length = i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> first;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>又看到了extend方法。。。我XXXXXX。在后面在分析extend的实现吧，先理解成jQuery的扩展方法即<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.merge(first,second) = <span class="function"><span class="keyword">function</span>(<span class="params"> first, second </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> len = +second.length,</span><br><span class="line">    j = <span class="number">0</span>,</span><br><span class="line">    i = first.length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( ; j &lt; len; j++ ) &#123;</span><br><span class="line">    first[ i++ ] = second[ j ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  first.length = i;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> first;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>举个例子一目了然：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = [<span class="number">0</span>,<span class="number">10</span>],s = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//$.merge(f,s)就是执行下面一段代码之后返回的first：</span></span><br><span class="line">    <span class="keyword">var</span> len = <span class="number">4</span>,j=<span class="number">0</span>,i=<span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//注意到这里是i++，first[ i++ ] = second[ j ]相当于first[i]=second[j];i++;</span></span><br><span class="line">    f[<span class="number">2</span>] = s[<span class="number">0</span>];    <span class="comment">//i=3</span></span><br><span class="line">    f[<span class="number">3</span>] = s[<span class="number">1</span>];    <span class="comment">//i=4</span></span><br><span class="line">    f[<span class="number">4</span>] = s[<span class="number">2</span>];    <span class="comment">//i=5</span></span><br><span class="line">    f[<span class="number">5</span>] = s[<span class="number">3</span>];    <span class="comment">//i=6</span></span><br><span class="line">    first.length = <span class="number">6</span></span><br><span class="line"><span class="comment">//此时first = [0,10,s[0],s[1],s[2],s[3]]，并且first.length = 6;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//综上所述，实际上$.merge(f,s)类似于数组的cancat方法，即f.concat(s)。也就是将两个类数组的jQuery对象合并</span></span><br></pre></td></tr></table></figure></p>
<p>接下来回到jQuery的pushStack方法，该方法的目的是将一个DOM元素集合加入到jQuery栈</p>
<ol>
<li><p>构建一个空的jQuery对象，无参 this.constructor()，只是返回引用this</p>
</li>
<li><p>jQuery.merge 把elems节点，合并到新的jQuery对象</p>
</li>
<li><p>给返回的新jQuery对象添加属性prevObject ，所以我们看到prevObject 其实还是当前jQuery的一个引用罢了</p>
</li>
</ol>
<p><strong>我理解的pushStack作用是缓存当前引用的jq对象。后期再看具体的用法吧</strong></p>
<h1 id="第三天">第三天</h1><p>7.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>循序渐进</p>
<p>（1）jQuery的type方法，在300行找到<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">type: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( obj == <span class="literal">null</span> ) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj + <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span> ?</span><br><span class="line">    class2type[ toString.call(obj) ] || <span class="string">"object"</span> :</span><br><span class="line">    <span class="keyword">typeof</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">` </span><br><span class="line">在前文中定义了class2type = &#123;&#125;</span><br><span class="line">这里注意了，在下文的一个地方，已经对class2type进行了初始化，在529行</span><br><span class="line">`</span><span class="string">``</span>javascript</span><br><span class="line">jQuery.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">  class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这段代码很好理解，就是相当于</span></span><br><span class="line"></span><br><span class="line">class2type = &#123;</span><br><span class="line">   <span class="string">"[object Boolean]"</span>: <span class="string">"array"</span>,</span><br><span class="line">   <span class="string">"[object Number]"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">   <span class="string">"[object String]"</span>: <span class="string">"date"</span>,</span><br><span class="line">   <span class="string">"[object Function]"</span>: <span class="string">"function"</span>,</span><br><span class="line">   <span class="string">"[object Array]"</span>: <span class="string">"number"</span>,</span><br><span class="line">   <span class="string">"[object Date]"</span>: <span class="string">"object"</span>,</span><br><span class="line">   <span class="string">"[object RegExp]"</span>: <span class="string">"regexp"</span>,</span><br><span class="line">   <span class="string">"[object Object]"</span>: <span class="string">"string"</span>,</span><br><span class="line">   <span class="string">"[object Error]"</span>: <span class="string">"error"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jQuery.type(<span class="literal">null</span>) === <span class="string">'null'</span> <span class="comment">//参数为null的情况下直接返回字符串'null'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span>  <span class="comment">//参数为object或者function类型</span></span><br><span class="line"></span><br><span class="line">class2type[ toString.call(obj) ] || <span class="string">"object"</span> <span class="comment">//参数为object或者function类型的情况下，寻找class2type看是否是javascript内置的九种类型，是的话就返回该类型的小写字母格式的字符串，否则一律返回"object"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> obj; <span class="comment">//参数不为object和function类型，直接返回参数的类型</span></span><br><span class="line"><span class="string">``</span><span class="string">` </span><br><span class="line">（2）jQuery的isWindow方法，在261行找到</span><br><span class="line">`</span><span class="string">``</span>javascript</span><br><span class="line">isWindow: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据这段代码可以推测，在某些环境中 null === null.window，o(╯□╰)o。<br>这段其实就是判断是否处于窗口环境比如在窗口环境jQuery.isWindow(window)返回true</p>
<p>（3）isArraylike函数，在533行找到<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArraylike</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> length = <span class="string">"length"</span> <span class="keyword">in</span> obj &amp;&amp; obj.length,</span><br><span class="line">    type = jQuery.type( obj );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( type === <span class="string">"function"</span> || jQuery.isWindow( obj ) ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//obj参数为function类型或者window，返回false</span></span><br><span class="line">  <span class="keyword">if</span> ( obj.nodeType === <span class="number">1</span> &amp;&amp; length ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//nodeType为1的情况是obj是HTML DOM元素</span></span><br><span class="line">  <span class="comment">//如果 var id = document.getElementById('#id'),id.nodeType ===1。但是同时加上判断存在length属性，就可以剔除掉单个dom元素的情况，可以保证为NodeList（类似数组）</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> type === <span class="string">"array"</span> || length === <span class="number">0</span> ||</span><br><span class="line">    <span class="keyword">typeof</span> length === <span class="string">"number"</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; ( length - <span class="number">1</span> ) <span class="keyword">in</span> obj;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//这里就比较蛋疼了，根据优先级，先比较 &amp;&amp;后比较||  </span></span><br><span class="line">    <span class="comment">//typeof length === "number" &amp;&amp; length &gt; 0 &amp;&amp; ( length - 1 ) in obj;</span></span><br><span class="line">    <span class="comment">//typeof length === "number"和length &gt; 0和( length - 1 ) in obj三个条件都满足，即为true</span></span><br><span class="line">    <span class="comment">//从左到右，如果obj类型为array，即为类数组，如果obj类型不是array，看obj的length属性，该属性值为0，只有一种情况就是类似于&#123;"length":0&#125;这种重写了length属性的对象，也是类数组。之后如果三个条件都满足，也是类数组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>综上，该函数从字面意思来看就是判断是否是类数组</p>
<p>（4）在345行找到了在jQuery上扩展的each方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> obj, callback, args </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value,</span><br><span class="line">    i = <span class="number">0</span>,</span><br><span class="line">    length = obj.length,</span><br><span class="line">    isArray = isArraylike( obj );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( args ) &#123;                                               <span class="comment">//如果有args参数</span></span><br><span class="line">    <span class="keyword">if</span> ( isArray ) &#123;                                        <span class="comment">//如果有args参数并且obj参数是类数组</span></span><br><span class="line">      <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">        value = callback.apply( obj[ i ], args ); </span><br><span class="line">        <span class="comment">//对于obj参数进行遍历，每一项都调用callback参数的方法，并且每一项都传入args参数，apply方法要求args参数以数组格式传入</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//判断如果遍历到某一项，callback回调用在这一项上返回了false，则跳出循环，停止遍历</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;                                               <span class="comment">//如果有args参数并且obj参数不是类数组</span></span><br><span class="line">      <span class="keyword">for</span> ( i <span class="keyword">in</span> obj ) &#123;                                 <span class="comment">//遍历obj的属性也就是key</span></span><br><span class="line">        value = callback.apply( obj[ i ], args );       <span class="comment">//</span></span><br><span class="line">                <span class="comment">//对于每一个obj属性对应的value，每一项都调用callback参数的方法，并且每一项都传入args参数，apply方法要求args参数以数组格式传入</span></span><br><span class="line">        <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断如果遍历到某一项，callback回调用在这一项上返回了false，则跳出循环，停止遍历</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;                                                <span class="comment">//如果不传args参数</span></span><br><span class="line">    <span class="keyword">if</span> ( isArray ) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;                    </span><br><span class="line">      <span class="comment">//可以看出以下的差别在于用了call方法，把对应的键key以及值value当成callback的参数进行遍历</span></span><br><span class="line">        value = callback.call( obj[ i ], i, obj[ i ] );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">        value = callback.call( obj[ i ], i, obj[ i ] );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出来each的作用是对于obj参数的每一项进行遍历，在callback返回false的时候停止遍历，其实并没有改变obj，原封不动的返回，只不过在每次遍历的时候，如果有参数args的时候，把参数传到callback函数中，没有参数args的时候，把obj的键、值（对于类数组，键相当于0,1,2,3这种的有序数字）两个参数传到callback函数中，在callback函数中就可以做想做的事情了（改变dom，输出值，计算等等）</p>
<p>（5）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>实际上（4）完成的是$.each方法，也就是“工具方法”（5）的目的是完成类似于jQuery(‘#id’).each的方法，很简</p>
<p>单，就是把jQuery(‘#id’)这个jQuery对象当做第一个obj参数传进去，完成$.each方法。</p>
<p>我觉得可以把以下两句理解成一个意思    </p>
<p><strong>\$(‘#id’).each(callback,args)</strong><br><strong>\$.each(\$(‘#id’),callback,args)</strong></p>
<p>8.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先从jQuery.map的扩展方法看起</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">map: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, arg </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value,</span><br><span class="line">    i = <span class="number">0</span>,</span><br><span class="line">    length = elems.length,</span><br><span class="line">    isArray = isArraylike( elems ),</span><br><span class="line">    ret = [];</span><br><span class="line">  <span class="keyword">if</span> ( isArray ) &#123;</span><br><span class="line">    <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">      value = callback( elems[ i ], i, arg );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">        ret.push( value );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i <span class="keyword">in</span> elems ) &#123;</span><br><span class="line">      value = callback( elems[ i ], i, arg );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">        ret.push( value );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> concat.apply( [], ret );     <span class="comment">//前文中定义了concat = [].concat</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以很显而易见,\$.each与\$.map方法很像，有两点不一样：<br>1.each方法返回为改变的obj，而map方法返回按照callback规则新生成的数组。<br>2.一种是用改变callback作用域为obj的每一个遍历的方法调用，一种是直接将obj作为参数传递，这样就导致两种方法的callback的写法不一样。</p>
<p>就each和map方法的区别，举个例子：</p>
<p>1.\$.each<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">    obj = &#123;name:<span class="number">1</span>,num:<span class="number">2</span>&#125;,</span><br><span class="line">    args = [<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">    newArray = [];</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackEach</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    newArray.push(<span class="keyword">this</span>+a+b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>定义好了\$.each方法需要的三个参数，array数组或者obj对象，callbackEach函数，args参数。分四种情况</p>
<p>（1）array数组，有args参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = $.each(array,callbackEach,args);</span><br><span class="line">result      <span class="comment">//  [1,2,3,4,5]</span></span><br><span class="line">array      <span class="comment">//  [1,2,3,4,5]</span></span><br><span class="line">newArray    <span class="comment">//  [4,5,6,7,8]</span></span><br><span class="line"><span class="comment">//  此时callbackEach的参数a，b分别是1,2</span></span><br></pre></td></tr></table></figure></p>
<p>（2）array数组，无args参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = $.each(array,callbackEach);</span><br><span class="line">result      <span class="comment">//  [1,2,3,4,5]</span></span><br><span class="line">array      <span class="comment">//  [1,2,3,4,5]</span></span><br><span class="line">newArray    <span class="comment">//  [2,5,8,11,14]  </span></span><br><span class="line"><span class="comment">//  此时callbackEach的参数a，b分别是各个项的序号，序号对应的值（0,1），（1,2），（2,3），（3,4），（4,5）</span></span><br></pre></td></tr></table></figure></p>
<p>（3）obj对象，有args参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = $.each(obj, callbackEach, args);</span><br><span class="line">result      <span class="comment">//  &#123;name:1,num:2&#125;</span></span><br><span class="line">obj      <span class="comment">//  &#123;name:1,num:2&#125;</span></span><br><span class="line">newArray    <span class="comment">//  [4,5]</span></span><br><span class="line"><span class="comment">//  此时callbackEach的参数a，b分别是1,2，将obj进行for-in遍历，将每个key对应的value与a，b相加生成结果数组</span></span><br></pre></td></tr></table></figure></p>
<p>（4）obj对象，无args参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = $.each(array,callbackEach);</span><br><span class="line">result      <span class="comment">//  &#123;name:1,num:2&#125;</span></span><br><span class="line">obj      <span class="comment">//  &#123;name:1,num:2&#125;</span></span><br><span class="line">newArray    <span class="comment">//  ["1name1", "2num2"]</span></span><br><span class="line"><span class="comment">//  将obj进行for-in遍历，此时callbackEach的参数a，b分别是每个遍历的key和对应的value，（name,1),(num,2)</span></span><br><span class="line"><span class="comment">//  而callbackEach里面的this是每个遍历对应的key</span></span><br></pre></td></tr></table></figure></p>
<p>2.\$.map<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    obj = &#123;</span><br><span class="line">      name: <span class="number">1</span>,</span><br><span class="line">      num: <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    args = <span class="number">1</span>,</span><br><span class="line">    newArray = [];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callbackMap</span>(<span class="params">val,key,args</span>) </span>&#123;</span><br><span class="line">    newArray.push(val + key + args);</span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>（1）array数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = $.map(array,callbackMap,args);</span><br><span class="line">result      <span class="comment">//  [1,2,3,4,5]</span></span><br><span class="line">array      <span class="comment">//  [0,1,2,3,4]</span></span><br><span class="line">newArray    <span class="comment">//  [2,4,6,8,10]</span></span><br><span class="line"><span class="comment">//  此时callbackEach的参数分别是array[i],i,args</span></span><br></pre></td></tr></table></figure>
<p>（2）obj对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = $.map(obj,callbackMap,args);</span><br><span class="line">result      <span class="comment">//  ["1name1", "2num1"]</span></span><br><span class="line">obj      <span class="comment">//  ["name", "num"]</span></span><br><span class="line">newArray    <span class="comment">//  &#123;name:1,num:2&#125;</span></span><br><span class="line"><span class="comment">//  此时callbackEach的参数分别是obj[i],i,args</span></span><br></pre></td></tr></table></figure>
<p>综上，可以明显看出来map和each的区别，callback调用方式和返回值的不同，map会生成一个新数组，如果没有特别必要的话算是浪费，所以我感觉还是each更方便一些。</p>
<p>讨论完jQuery扩展的map，再回到绑定在原型上的map</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先来看<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></p>
<p>这里的map第一个参数this，即是匹配到的jQuery对象，如$(‘.class’);<br>这里的map第二个参数，则是<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据上文isArraylike函数的定义，由于typeof jQuery为’function’，因此isArraylike(jQuery)为false此根据扩展的map的定义，可以将<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>理解为执行了下面一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> value,</span><br><span class="line">  i = <span class="number">0</span>,</span><br><span class="line">  ret = [];</span><br><span class="line"><span class="keyword">for</span> ( i <span class="keyword">in</span> jQuery ) &#123;</span><br><span class="line">  value = callback.call( $(<span class="string">'.class'</span>)[i], i, $(<span class="string">'.class'</span>)[i] );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">    ret.push( value );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> concat.apply( [], ret );</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>也就是说遍历jQuery的属性，对于每一种属性都调用callback方法，这个方法三个参数分别是value，key，value<br>最后，把每一项callback的返回值（如果有的话）组成数组返回。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.pushStack( jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> elem, i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callback.call( elem, i, elem );</span><br><span class="line">  &#125;))</span><br></pre></td></tr></table></figure>
<p>这段就很好理解了，就是在执行完遍历操作之后，把上一步返回的新数组压入jp的栈中，以便日后某些情况再使用<br>眼睛尖的骚年就能看出来了，对于\$(‘.class’).each(function(){})和\$(‘.class’).map(function(){})唯一的区别在于后者返回了新的jq对象，可以再次执行与jq有关的操作。。。</p>
<p>9.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( slice.apply( <span class="keyword">this</span>, <span class="built_in">arguments</span> ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很好理解，就是用Array的slice方法应用在jq对象上，对应的arguments就是slice方法传递的所有参数，注意，arguments是以类似数组形式呈现的，所以用了apply方法，返回一个jq栈用来操作。</p>
<p>10.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.eq( <span class="number">0</span> );</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.eq( -<span class="number">1</span> );</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">eq: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> len = <span class="keyword">this</span>.length,</span><br><span class="line">    j = +i + ( i &lt; <span class="number">0</span> ? len : <span class="number">0</span> );</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.pushStack( j &gt;= <span class="number">0</span> &amp;&amp; j &lt; len ? [ <span class="keyword">this</span>[j] ] : [] );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先研究eq方法，<br>如果传进去的参数是负数，j就是将参数与jq对象的长度相加，相当于js数组的负数序号的意思<br>j取值在[0,len-1]的区间中，将对应的jq对象压入jq栈，否则返回空数组</p>
<p>first和last方法就很好理解了，返回第一个匹配到的和最后一个匹配到的jq对象。</p>
<p>11.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">end: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.prevObject || <span class="keyword">this</span>.constructor(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里就能体会到pushStack方法的prevObject用处了,prevObject从字面意思上就可以看到是对上一个jq对象的引用。<br>举个很简单的例子来解释prevObject和pushStack。</p>
<p>匹配一个\$(‘div’).find(‘p’)，此时先匹配到了div标签，那就相当于在堆书，放了一本div的书在底下，然后匹配到了p标签，将一本p的书放在了div书的上面，这个过程就是pushStack，此时prevObject存储的是div的书，此时我再执行\$(‘div’).find(‘p’).end()，返回的就是prevObject，也就是第一次放的书div，以此类推，一直往上堆书的过程就是堆栈，最后一次放的书总是第一次拿出，也就是“后进先出”</p>
<p>这段代码就比较好理解了，如果存在prevObject，就存储上一次匹配到的jq对象，否则返回一个空的jq对象。</p>
<p>12.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push: push,</span><br><span class="line">sort: arr.sort,</span><br><span class="line">splice: arr.splice</span><br></pre></td></tr></table></figure>
<p>无意中发现，原来Array的方法基本上都能用在Object对象上，这位仁兄已经做了试验，<br><a href="http://www.cnblogs.com/idche/archive/2012/03/17/2403894.html" target="_blank" rel="external">传送门</a>。</p>
<p>至此为止，绑定在jQuery原型上的方法分析完毕！</p>
<h1 id="第四天">第四天</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//177--240行</span></span><br><span class="line">jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</span><br><span class="line">    target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</span><br><span class="line">    i = <span class="number">1</span>,</span><br><span class="line">    length = <span class="built_in">arguments</span>.length,</span><br><span class="line">    deep = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</span><br><span class="line">    deep = target;</span><br><span class="line">    target = <span class="built_in">arguments</span>[ i ] || &#123;&#125;;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target) ) &#123;</span><br><span class="line">    target = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( i === length ) &#123;</span><br><span class="line">    target = <span class="keyword">this</span>;</span><br><span class="line">    i--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (options = <span class="built_in">arguments</span>[ i ]) != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><br><span class="line">        src = target[ name ];</span><br><span class="line">        copy = options[ name ];</span><br><span class="line">        <span class="keyword">if</span> ( target === copy ) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) &#123;</span><br><span class="line">          <span class="keyword">if</span> ( copyIsArray ) &#123;</span><br><span class="line">            copyIsArray = <span class="literal">false</span>;</span><br><span class="line">            clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</span><br><span class="line"></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">          target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">          target[ name ] = copy;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>以上这段代码实现jQuery的extend扩展功能。慢慢琢磨。。<br>整理了一下，这段代码包含jQuery.isFunction，jQuery.isPlainObject，jQuery.isArray三个jQuery的方法<br>一步步来</p>
<p>1.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isFunction: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> jQuery.type(obj) === <span class="string">"function"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>jQuery.type分析过，是加强型的typeof方法，这段代码判断是否是function类型</p>
<p>2.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">isPlainObject: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( jQuery.type( obj ) !== <span class="string">"object"</span> || obj.nodeType || jQuery.isWindow( obj ) ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( obj.constructor &amp;&amp;</span><br><span class="line">      !hasOwn.call( obj.constructor.prototype, <span class="string">"isPrototypeOf"</span> ) ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第一个if来判断，对于object，HTML DOM Element 对象，window，返回false<br>第二个if来判断，对象obj的原型对象中没有属性isPrototypeOf。属性isPrototypeOf是Object原型对象的特有属性，如果对象obj的原型对象中没有，说明不是由构造函数Object()创建，而是由自定义构造函数创建，返回false</p>
<p>综上，这段代码来判断是否是直接用字面量{}或new Object()创建的对象</p>
<p>3.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isArray: <span class="built_in">Array</span>.isArray,</span><br></pre></td></tr></table></figure></p>
<p>判断是否是数组类型</p>
<p>准备工作结束，进入正文<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//target = arguments[0] || &#123;&#125;   deep = false    i=1    </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下文称判断一</span></span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> target === <span class="string">"boolean"</span> ) &#123;</span><br><span class="line">  deep = target;</span><br><span class="line">  target = <span class="built_in">arguments</span>[ i ] || &#123;&#125;;</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">如果$.extend()或者$('#id').extend()传递的第一个参数是true或者false，</span><br><span class="line">则deep赋值为传递的第一个参数，target赋值为传递的第二个参数，i为2</span><br><span class="line">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下文称判断二</span></span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target) ) &#123;</span><br><span class="line">  target = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">如果target（若extend传递的第一个参数为boolean，则target修正为传递的第二个参数，否则为传递的第一个参数）不是object类型也不是function类型（包含[object Function]），target赋值为空对象字面量&#123;&#125;</span><br><span class="line">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下文称判断三，根据具体代码，判断三重写了target，因此进入到判断三的情况下可以忽略判断二</span></span><br><span class="line"><span class="keyword">if</span> ( i === length ) &#123;</span><br><span class="line">  target = <span class="keyword">this</span>;</span><br><span class="line">  i--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下文称for循环</span></span><br><span class="line"><span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">  <span class="keyword">if</span> ( (options = <span class="built_in">arguments</span>[ i ]) != <span class="literal">null</span> ) &#123;</span><br><span class="line"><span class="comment">//下文称for in循环</span></span><br><span class="line">    <span class="keyword">for</span> ( name <span class="keyword">in</span> options ) &#123;</span><br><span class="line">      src = target[ name ];</span><br><span class="line">      copy = options[ name ];</span><br><span class="line">      <span class="keyword">if</span> ( target === copy ) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( copyIsArray ) &#123;</span><br><span class="line">          copyIsArray = <span class="literal">false</span>;</span><br><span class="line">          clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( copy !== <span class="literal">undefined</span> ) &#123;</span><br><span class="line">        target[ name ] = copy;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">根据上面的if判断，总共分成以下几种情况：</span><br><span class="line"></span><br><span class="line">1.extend不传参数，此时i为1，length为0，target为&#123;&#125;，进入不到三个判断以及for循环，直接返回空对象&#123;&#125;</span><br><span class="line"></span><br><span class="line">2.extend传一个boolean参数，进入判断一，此时target为&#123;&#125;，i为2，length为1，进入不到for循环，直接返回空对象&#123;&#125;</span><br><span class="line"></span><br><span class="line">3.extend传一个非boolean参数，此时i为1，length为1，进入判断三，target为this（  $或者$('#id')  ），i为0，length为1，进入不到for循环，返回this（  $或者$('#id')  ）</span><br><span class="line"></span><br><span class="line">4.extend传两个或者多个参数，</span><br><span class="line"></span><br><span class="line">第一个参数为boolean参数，进入到判断一，target修正为第二个参数，i为2，deep为第一个参数</span><br><span class="line">    如果传两个参数，进入到判断三，target修正为this，i为1</span><br><span class="line">    如果传三个或多个参数，target为第二个参数，i为2</span><br><span class="line"></span><br><span class="line">第一个参数不为boolean参数且不是object或function类型，target为&#123;&#125;，deep为false，</span><br><span class="line"></span><br><span class="line">第一个参数是object或function类型，target为第一个参数，deep为false，</span><br><span class="line"></span><br><span class="line">length为参数个数，进入到for循环</span><br><span class="line"></span><br><span class="line">if ( (options = arguments[ i ]) != null )&#123;&#125;</span><br><span class="line"></span><br><span class="line">4.1  如果参数为null，则进入不到for里的if，直接进行下一次for循环</span><br><span class="line"></span><br><span class="line">4.2  如果参数不为null</span><br><span class="line"></span><br><span class="line">for ( name in options ) &#123;&#125;</span><br><span class="line"></span><br><span class="line">进入到对于options进行的for in穷举，以下称options的name属性。</span><br><span class="line"></span><br><span class="line">src = target[ name ];</span><br><span class="line">copy = options[ name ];</span><br><span class="line">        </span><br><span class="line">target为上文中的this，即（  $或者$('#id')  ），src为  $或者$('#id')  的name属性值，copy为options（第二个参数）的name属性值</span><br><span class="line"></span><br><span class="line">if ( target === copy ) &#123;</span><br><span class="line">  continue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在这里，如果target与copy值相等，跳出for in循环，在进行下一次的for循环</span><br><span class="line"></span><br><span class="line">if ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) &#123;&#125;</span><br><span class="line"></span><br><span class="line">a....deep为extend传递的第一个boolean参数，</span><br><span class="line">b...copy为option的name属性值，</span><br><span class="line">c...jQuery.isPlainObject(copy)，判断copy是否是直接字面量&#123;&#125;或new Object()创造的对象，</span><br><span class="line">d...jQuery.isArray(copy)，判断copy是否是数组类型</span><br><span class="line">a,b,c都为true，或者d为true，进入到满足这里的if判断</span><br><span class="line"></span><br><span class="line">if ( copyIsArray ) &#123;</span><br><span class="line">  copyIsArray = false;</span><br><span class="line">  clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果option的name属性值是数组类型，copyIsArray修正为false，target的name属性值存在且为数组类型，则</span><br><span class="line">clone变量为该值，否则为空数组[]</span><br><span class="line"></span><br><span class="line">else &#123;</span><br><span class="line">  clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果option的name属性值不是数组类型，target的name属性值存在且为直接字面量&#123;&#125;或new Object()创造的对象，则clone变量为该值，否则为空对象&#123;&#125;</span><br><span class="line"></span><br><span class="line">target[ name ] = jQuery.extend( deep, clone, copy );</span><br><span class="line"></span><br><span class="line">进行深度复制，不是简单的将同名name属性覆盖，而是继续遍历name属性下的属性，将name属性下的所有的属性也添加上</span><br><span class="line"></span><br><span class="line">else if ( copy !== undefined ) &#123;</span><br><span class="line">  target[ name ] = copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果deep为false，传第一个参数为false或者第一个参数不为boolean，则直接将target的name属性赋值为对应的options的name属性</span><br><span class="line"></span><br><span class="line">返回target</span><br><span class="line">        </span><br><span class="line">**/</span></span><br></pre></td></tr></table></figure></p>
<p>综上可以看出，extend的目的是将一个或者多个对象的属性或者方法赋值给目标对象。<br>一般有以下几种用法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myCopy = &#123;a:&#123;b:<span class="number">1</span>,c:<span class="number">2</span>&#125;&#125;,myTarget = &#123;a:&#123;b:<span class="number">2</span>,d:<span class="number">2</span>&#125;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>1.如果extend的第一个参数是true，就是深度复制，在对复制对象每一次for in循环过后对于循环出来的结果，如果该结果还有更多的属性，则将更多的属性也提取出来，添加到目标对象上<br>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(<span class="literal">true</span>,myTarget,myCopy);</span><br></pre></td></tr></table></figure></p>
<p>此时目标对象就是myTarget，myCopy上深复制，给myTarget添加a属性（myTarget也存在a属性，则对于a属性值继续挖掘，对于coyp上的a.b覆盖myTarget的a.b，对于coyp上的a.c添加到myTarget.a上）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(<span class="literal">true</span>,myTarget,myCopy).a;    <span class="comment">//&#123;b:1,d:2,c:2&#125;</span></span><br></pre></td></tr></table></figure>
<p>2.如果extend的第一个参数是复制对象，或者是false，就是浅度复制，直接将之后的参数对象上的属性添加到目标对象上</p>
<p>例如：</p>
<p>（1）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(myCopy);</span><br></pre></td></tr></table></figure></p>
<p>等同于<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(<span class="literal">false</span>,myCopy);</span><br></pre></td></tr></table></figure></p>
<p>此时目标对象就是this，即\$，就是在\myCopy上浅复制，给\$添加a属性<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.a;    <span class="comment">//&#123;b:1,c:2&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>（2）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(myTarget,myCopy);</span><br></pre></td></tr></table></figure></p>
<p>等同于<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(<span class="literal">false</span>,myTarget,myCopy);</span><br></pre></td></tr></table></figure></p>
<p>此时目标对象就是myTarget，myCopy上浅复制，给myTarget添加a属性（覆盖myTarget上的a属性）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.extend(myTarget,myCopy).a;    <span class="comment">//&#123;b:1,c:2&#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="第四天-1">第四天</h1><h2 id="jQuery的扩展方法">jQuery的扩展方法</h2><p>其中isPlainObject，isPlainObject，type，each，merge，map方法前文已提及，不赘述。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//242行到526行</span></span><br><span class="line">jQuery.extend(&#123;</span><br><span class="line">  expando: <span class="string">"jQuery"</span> + ( version + <span class="built_in">Math</span>.random() ).replace( <span class="regexp">/\D/g</span>, <span class="string">""</span> ),</span><br><span class="line">  isReady: <span class="literal">true</span>,</span><br><span class="line">  error: <span class="function"><span class="keyword">function</span>(<span class="params"> msg </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( msg );</span><br><span class="line">  &#125;,</span><br><span class="line">  noop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">  isFunction: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jQuery.type(obj) === <span class="string">"function"</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  isArray: <span class="built_in">Array</span>.isArray,</span><br><span class="line">  isWindow: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">  &#125;,</span><br><span class="line">  isNumeric: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !jQuery.isArray( obj ) &amp;&amp; (obj - <span class="built_in">parseFloat</span>( obj ) + <span class="number">1</span>) &gt;= <span class="number">0</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  isPlainObject: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( jQuery.type( obj ) !== <span class="string">"object"</span> || obj.nodeType || jQuery.isWindow( obj ) ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( obj.constructor &amp;&amp;</span><br><span class="line">        !hasOwn.call( obj.constructor.prototype, <span class="string">"isPrototypeOf"</span> ) ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  isEmptyObject: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    <span class="keyword">for</span> ( name <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  type: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( obj == <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">return</span> obj + <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span> ?</span><br><span class="line">      class2type[ toString.call(obj) ] || <span class="string">"object"</span> :</span><br><span class="line">      <span class="keyword">typeof</span> obj;</span><br><span class="line">  &#125;,</span><br><span class="line">  globalEval: <span class="function"><span class="keyword">function</span>(<span class="params"> code </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> script,</span><br><span class="line">      indirect = <span class="built_in">eval</span>;</span><br><span class="line">    code = jQuery.trim( code );</span><br><span class="line">    <span class="keyword">if</span> ( code ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( code.indexOf(<span class="string">"use strict"</span>) === <span class="number">1</span> ) &#123;</span><br><span class="line">        script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">        script.text = code;</span><br><span class="line">        <span class="built_in">document</span>.head.appendChild( script ).parentNode.removeChild( script );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        indirect( code );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  camelCase: <span class="function"><span class="keyword">function</span>(<span class="params"> string </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> string.replace( rmsPrefix, <span class="string">"ms-"</span> ).replace( rdashAlpha, fcamelCase );</span><br><span class="line">  &#125;,</span><br><span class="line">  nodeName: <span class="function"><span class="keyword">function</span>(<span class="params"> elem, name </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> elem.nodeName &amp;&amp; elem.nodeName.toLowerCase() === name.toLowerCase();</span><br><span class="line">  &#125;,</span><br><span class="line">  each: <span class="function"><span class="keyword">function</span>(<span class="params"> obj, callback, args </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value,</span><br><span class="line">      i = <span class="number">0</span>,</span><br><span class="line">      length = obj.length,</span><br><span class="line">      isArray = isArraylike( obj );</span><br><span class="line">    <span class="keyword">if</span> ( args ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( isArray ) &#123;</span><br><span class="line">        <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">          value = callback.apply( obj[ i ], args );</span><br><span class="line">          <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( i <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">          value = callback.apply( obj[ i ], args );</span><br><span class="line">          <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ( isArray ) &#123;</span><br><span class="line">        <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">          value = callback.call( obj[ i ], i, obj[ i ] );</span><br><span class="line">          <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> ( i <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">          value = callback.call( obj[ i ], i, obj[ i ] );</span><br><span class="line">          <span class="keyword">if</span> ( value === <span class="literal">false</span> ) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;,</span><br><span class="line">  trim: <span class="function"><span class="keyword">function</span>(<span class="params"> text </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> text == <span class="literal">null</span> ?</span><br><span class="line">      <span class="string">""</span> :</span><br><span class="line">      ( text + <span class="string">""</span> ).replace( rtrim, <span class="string">""</span> );</span><br><span class="line">  &#125;,</span><br><span class="line">  makeArray: <span class="function"><span class="keyword">function</span>(<span class="params"> arr, results </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ret = results || [];</span><br><span class="line">    <span class="keyword">if</span> ( arr != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( isArraylike( <span class="built_in">Object</span>(arr) ) ) &#123;</span><br><span class="line">        jQuery.merge( ret,</span><br><span class="line">          <span class="keyword">typeof</span> arr === <span class="string">"string"</span> ?</span><br><span class="line">          [ arr ] : arr</span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        push.call( ret, arr );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;,</span><br><span class="line">  inArray: <span class="function"><span class="keyword">function</span>(<span class="params"> elem, arr, i </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arr == <span class="literal">null</span> ? -<span class="number">1</span> : indexOf.call( arr, elem, i );</span><br><span class="line">  &#125;,</span><br><span class="line">  merge: <span class="function"><span class="keyword">function</span>(<span class="params"> first, second </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = +second.length,</span><br><span class="line">      j = <span class="number">0</span>,</span><br><span class="line">      i = first.length;</span><br><span class="line">    <span class="keyword">for</span> ( ; j &lt; len; j++ ) &#123;</span><br><span class="line">      first[ i++ ] = second[ j ];</span><br><span class="line">    &#125;</span><br><span class="line">    first.length = i;</span><br><span class="line">    <span class="keyword">return</span> first;</span><br><span class="line">  &#125;,</span><br><span class="line">  grep: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, invert </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> callbackInverse,</span><br><span class="line">      matches = [],</span><br><span class="line">      i = <span class="number">0</span>,</span><br><span class="line">      length = elems.length,</span><br><span class="line">      callbackExpect = !invert;</span><br><span class="line">    <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">      callbackInverse = !callback( elems[ i ], i );</span><br><span class="line">      <span class="keyword">if</span> ( callbackInverse !== callbackExpect ) &#123;</span><br><span class="line">        matches.push( elems[ i ] );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> matches;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  map: <span class="function"><span class="keyword">function</span>(<span class="params"> elems, callback, arg </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value,</span><br><span class="line">      i = <span class="number">0</span>,</span><br><span class="line">      length = elems.length,</span><br><span class="line">      isArray = isArraylike( elems ),</span><br><span class="line">      ret = [];</span><br><span class="line">    <span class="keyword">if</span> ( isArray ) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( ; i &lt; length; i++ ) &#123;</span><br><span class="line">        value = callback( elems[ i ], i, arg );</span><br><span class="line">        <span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">          ret.push( value );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i <span class="keyword">in</span> elems ) &#123;</span><br><span class="line">        value = callback( elems[ i ], i, arg );</span><br><span class="line">        <span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">          ret.push( value );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> concat.apply( [], ret );</span><br><span class="line">  &#125;,</span><br><span class="line">  guid: <span class="number">1</span>,</span><br><span class="line">  proxy: <span class="function"><span class="keyword">function</span>(<span class="params"> fn, context </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp, args, proxy;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> context === <span class="string">"string"</span> ) &#123;</span><br><span class="line">      tmp = fn[ context ];</span><br><span class="line">      context = fn;</span><br><span class="line">      fn = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !jQuery.isFunction( fn ) ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    args = slice.call( <span class="built_in">arguments</span>, <span class="number">2</span> );</span><br><span class="line">    proxy = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> fn.apply( context || <span class="keyword">this</span>, args.concat( slice.call( <span class="built_in">arguments</span> ) ) );</span><br><span class="line">    &#125;;</span><br><span class="line">    proxy.guid = fn.guid = fn.guid || jQuery.guid++;</span><br><span class="line">    <span class="keyword">return</span> proxy;</span><br><span class="line">  &#125;,</span><br><span class="line">  now: <span class="built_in">Date</span>.now,</span><br><span class="line">  support: support</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>1.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">  <span class="comment">//Unique for each copy of jQuery on the page</span></span><br><span class="line">  expando: <span class="string">"jQuery"</span> + ( version + <span class="built_in">Math</span>.random() ).replace( <span class="regexp">/\D/g</span>, <span class="string">""</span> ),</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Assume jQuery is ready without the ready module</span></span><br><span class="line">  isReady: <span class="literal">true</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//$.error会抛出个错误</span></span><br><span class="line">  error: <span class="function"><span class="keyword">function</span>(<span class="params"> msg </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( msg );</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//空函数</span></span><br><span class="line">  noop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//$.isFunction(obj)判断obj是否是函数类型</span></span><br><span class="line">  isFunction: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jQuery.type(obj) === <span class="string">"function"</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//$.isArray(obj)判断obj是否是数组类型</span></span><br><span class="line">  isArray: <span class="built_in">Array</span>.isArray,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//$.isWindow(obj)判断obj是否是window变量</span></span><br><span class="line">  isWindow: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//$.isNumeric(obj)判断obj是否是数字变量或者是能转换成数字的字符串</span></span><br><span class="line">  isNumeric: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !jQuery.isArray( obj ) &amp;&amp; (obj - <span class="built_in">parseFloat</span>( obj ) + <span class="number">1</span>) &gt;= <span class="number">0</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//$.isEmptyObject(obj)判断obj是否是空对象&#123;&#125;或者new Object();</span></span><br><span class="line">  isEmptyObject: <span class="function"><span class="keyword">function</span>(<span class="params"> obj </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name;</span><br><span class="line">    <span class="keyword">for</span> ( name <span class="keyword">in</span> obj ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">    trim: <span class="function"><span class="keyword">function</span>(<span class="params"> text </span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> text == <span class="literal">null</span> ?</span><br><span class="line">        <span class="string">""</span> :</span><br><span class="line">        ( text + <span class="string">""</span> ).replace( rtrim, <span class="string">""</span> );</span><br><span class="line">    &#125;,</span><br><span class="line">    globalEval: <span class="function"><span class="keyword">function</span>(<span class="params"> code </span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> script,</span><br><span class="line">        indirect = <span class="built_in">eval</span>;</span><br><span class="line">      code = jQuery.trim( code );</span><br><span class="line">      <span class="keyword">if</span> ( code ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( code.indexOf(<span class="string">"use strict"</span>) === <span class="number">1</span> ) &#123;</span><br><span class="line">          script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">          script.text = code;</span><br><span class="line">          <span class="built_in">document</span>.head.appendChild( script ).parentNode.removeChild( script );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          indirect( code );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>作者 杨习习<br>2015 年 10月 21日    </p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/07/13/2/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">系统</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 张小玩
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>